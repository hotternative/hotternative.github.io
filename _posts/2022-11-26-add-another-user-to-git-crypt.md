---
title: "Add another user to git-crypt"
date: 2022-11-26
---

After the initial set-ups in [the previous post]({% post_url 2022-11-24-use-git-crypt-to-store-sensitive-information-first-user %}),
we would like to add another user to the repo which is approved to access and update the secrets.

## Generate a new gpg key pair 
The new engineer needs to run 
```shell
gpg --default-new-key-algo rsa3072 --full-generate-key
```
Then select Option 1 and follow the steps to generate the key pair. 
An email address and a name are required to generate the key pair.

The new engineer needs to take a note of the key file name, which looks like
`A49C7704A9C63894C75937897A4548F83C86403D`

Once the key pair is generated, obtain the public key by 
```
gpg --export -a <email_aaddress_supplied_when_generating_the_key_pair>
```
The new engineer will need to share the public key and the file name to an authroised 
user or an admin of the repo.


## Add the new user

This step needs to be done by an existing git-crypt user or an admin of the repo.
The admin shall create a new key file 
```shell
touch <key_file_name>.gpg
```
Save the public key into the file just created.

Import GPG public key:
```shell
gpg --import <key_file_name>.gpg
```
Check the key is imported OK by
```shell
gpg --list-keys  
```

Then the admin shall create a new branch to the repo.
Next, teh admin shall add the user by:
```shell
git-crypt add-gpg-user <key_file_name>
```
where the `key_file_name` is generated by the new engineer and shared with the admin.

This last command automatically creates a git commit for you. 
Check it by `git log`.
There is no need for any manual git add or git commit.

Then, create a PR based on this branch.

Once the PR is merged, the new user will be able to 
```shell
git crypt unlock
```
to see the encrypted files.